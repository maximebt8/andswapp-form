<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Créer mon profil &SWAPP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 50%, #f8fafc 100%);
            min-height: 100%;
        }
        
        html, body {
            height: 100%;
        }
        
        :root {
            --green-dark: #2E5941;
            --green-light: #A5C1AA;
            --yellow: #FFCC00;
            --yellow-hover: #e6b800;
        }
        
        .form-container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .step-card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 10px 40px rgba(46, 89, 65, 0.1);
            overflow: hidden;
            margin-bottom: 2rem;
        }
        
        .step-header {
            background: linear-gradient(135deg, var(--green-dark) 0%, #3a6b4f 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        .step-content {
            padding: 2rem;
        }
        
        .selection-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .selection-card:hover {
            border-color: #d1d5db;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
        }
        
        .selection-card.selected {
            border-color: var(--green-dark);
            background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%);
            box-shadow: 0 8px 25px rgba(46, 89, 65, 0.12);
            transform: translateY(-2px);
        }
        
        .selection-card.selected::after {
            content: '✓';
            position: absolute;
            top: 16px;
            right: 16px;
            background: var(--green-dark);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .input-field {
            background: white;
            border: 2px solid #f3f4f6;
            border-radius: 12px;
            padding: 1rem;
            transition: all 0.3s ease;
            font-size: 16px;
            width: 100%;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--green-dark);
            box-shadow: 0 0 0 4px rgba(46, 89, 65, 0.1);
        }
        
        .textarea-field {
            background: white;
            border: 2px solid #f3f4f6;
            border-radius: 12px;
            padding: 1rem;
            transition: all 0.3s ease;
            font-size: 16px;
            width: 100%;
            min-height: 120px;
            resize: vertical;
        }
        
        .textarea-field:focus {
            outline: none;
            border-color: var(--green-dark);
            box-shadow: 0 0 0 4px rgba(46, 89, 65, 0.1);
        }
        
        .btn-primary {
            background: var(--yellow);
            color: var(--green-dark);
            border: none;
            border-radius: 12px;
            padding: 1rem 2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 204, 0, 0.3);
            font-size: 16px;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: var(--yellow-hover);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 204, 0, 0.4);
        }
        
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: white;
            color: var(--green-dark);
            border: 2px solid var(--green-light);
            border-radius: 12px;
            padding: 1rem 2rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }
        
        .btn-secondary:hover {
            border-color: var(--green-dark);
            background: #f0f9f2;
            transform: translateY(-1px);
        }
        
        .btn-skip {
            background: #f8fafc;
            color: #64748b;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .btn-skip:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }
        
        .progress-bar {
            background: #e5e7eb;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, var(--yellow) 0%, #ffd700 100%);
            height: 100%;
            transition: width 0.5s ease;
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e5e7eb;
            margin: 0 6px;
            transition: all 0.3s ease;
        }
        
        .step-dot.active {
            background: var(--yellow);
            transform: scale(1.2);
        }
        
        .step-dot.completed {
            background: var(--green-dark);
        }
        
        .required::after {
            content: ' *';
            color: #ef4444;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 24px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
        }
        
        .modal.show .modal-content {
            transform: scale(1);
        }
        
        .emoji-large {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }
        
        .date-range {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .flexible-option {
            background: #f0f9ff;
            border: 2px solid #bae6fd;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .flexible-option.selected {
            border-color: var(--green-dark);
            background: #f0fdf4;
        }
        
        .priority-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .priority-1 {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .priority-2 {
            background: #fef3c7;
            color: #d97706;
        }
        
        .priority-3 {
            background: #f0f9ff;
            color: #2563eb;
        }

        .copy-button {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-left: 0.5rem;
        }
        
        .copy-button:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }
        
        .copy-button.copied {
            background: #dcfce7;
            border-color: #16a34a;
            color: #16a34a;
        }

        .city-vignette {
            transition: all 0.2s ease;
            font-weight: 500;
        }
        
        .city-vignette:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }
        
        .city-vignette:active {
            transform: translateY(0);
        }

        .assistant-modal .modal-content {
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            text-align: left;
        }

        .assistant-section {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .assistant-preview {
            background: #f0fdf4;
            border: 2px solid #bbf7d0;
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
            min-height: 100px;
        }

        .quality-tag {
            display: inline-block;
            background: #e0f2fe;
            border: 1px solid #0891b2;
            border-radius: 20px;
            padding: 0.25rem 0.75rem;
            margin: 0.25rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quality-tag.selected {
            background: var(--green-dark);
            color: white;
            border-color: var(--green-dark);
        }

        .quality-tag:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .city-suggestion {
            padding: 0.75rem;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: background-color 0.2s ease;
        }

        .city-suggestion:hover {
            background-color: #f8fafc;
        }

        .city-suggestion:last-child {
            border-bottom: none;
        }

        .city-suggestion.highlighted {
            background-color: #f0f9ff;
            border-left: 3px solid var(--green-dark);
        }

        .city-suggestion-name {
            font-weight: 600;
            color: var(--green-dark);
        }

        .city-suggestion-details {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        
        @media (max-width: 768px) {
            .form-container {
                padding: 1rem;
            }
            
            .step-card {
                border-radius: 16px;
            }
            
            .step-content {
                padding: 1.5rem;
            }

            .assistant-modal .modal-content {
                max-width: 95%;
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="min-h-full">
        <!-- Header -->
        <div class="bg-white border-b border-gray-100 sticky top-0 z-40">
            <div class="form-container py-4 px-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="text-2xl font-bold text-green-800">&SWAPP</div>
                        <div class="ml-4 text-gray-600">
                            <span class="text-sm">✨ Création de profil</span>
                        </div>
                    </div>
                    <div class="text-sm text-gray-500">
                        Étape <span id="current-step">1</span> sur 4
                    </div>
                </div>
            </div>
        </div>

        <div class="form-container py-8 px-4">
            <!-- Wrap everything in a form so Zapier can receive fields by name -->
            <!-- Set action to your Zapier webhook URL when ready -->
            <form id="profile-form" method="post" action="">
                <!-- Progress Bar -->
                <div class="mb-8">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 25%"></div>
                    </div>
                    <div class="step-indicator mt-4">
                        <div class="step-dot active" data-step="1"></div>
                        <div class="step-dot" data-step="2"></div>
                        <div class="step-dot" data-step="3"></div>
                        <div class="step-dot" data-step="4"></div>
                    </div>
                </div>

                <!-- Étape 1: Info sur mon appartement -->
                <div class="step-card" id="step-1">
                    <div class="step-header">
                        <div class="priority-badge priority-1">ÉTAPE 1</div>
                        <div class="emoji-large">🏡</div>
                        <h2 class="text-2xl font-bold mb-2">Info sur mon appartement</h2>
                        <p class="text-green-100">Présentez votre logement aux futurs swappers</p>
                    </div>
                    <div class="step-content">
                        <div class="space-y-6">
                            <!-- Localisation -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700 mb-4">📍 Localisation</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label for="country" class="block text-sm font-medium text-gray-700 mb-2 required">Pays</label>
                                        <select id="country" name="country" class="input-field" required>
                                            <option value="">Sélectionner un pays</option>
                                            <option value="FR">France</option>
                                            <option value="ES">Espagne</option>
                                            <option value="IT">Italie</option>
                                            <option value="DE">Allemagne</option>
                                            <option value="UK">Royaume-Uni</option>
                                            <option value="US">États-Unis</option>
                                            <option value="CA">Canada</option>
                                            <option value="PT">Portugal</option>
                                            <option value="BE">Belgique</option>
                                            <option value="CH">Suisse</option>
                                            <option value="NL">Pays-Bas</option>
                                            <option value="other">Autre</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label for="region" class="block text-sm font-medium text-gray-700 mb-2 required">Région / État / Département</label>
                                        <input type="text" id="region" name="region" class="input-field" placeholder="Ex: Île-de-France, Californie, Toscane..." required>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label for="city" class="block text-sm font-medium text-gray-700 mb-2 required">Ville</label>
                                            <div class="relative">
                                                <input type="text" id="city" name="city" class="input-field" placeholder="Ex: Paris, Lyon, Marseille..." required autocomplete="off">
                                                <div id="city-suggestions" class="absolute z-10 w-full bg-white border border-gray-200 rounded-lg shadow-lg hidden max-h-60 overflow-y-auto"></div>
                                            </div>
                                        </div>
                                        <div>
                                            <label for="postal-code" class="block text-sm font-medium text-gray-700 mb-2 required">Code postal</label>
                                            <input type="text" id="postal-code" name="postalCode" class="input-field" placeholder="Ex: 75001" required>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Caractéristiques -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700 mb-4">🏘️ Caractéristiques</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2 required">Nombre de chambres</label>
                                        <select id="bedrooms" name="bedrooms" class="input-field" required>
                                            <option value="">Sélectionner</option>
                                            <option value="0">Studio</option>
                                            <option value="1">1 chambre</option>
                                            <option value="2">2 chambres</option>
                                            <option value="3">3 chambres</option>
                                            <option value="4">4 chambres</option>
                                            <option value="5+">5+ chambres</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2 required">Nombre de couchages</label>
                                        <select id="sleeping-spots" name="sleepingSpots" class="input-field" required>
                                            <option value="">Sélectionner</option>
                                            <option value="1">1 personne</option>
                                            <option value="2">2 personnes</option>
                                            <option value="4">4 personnes</option>
                                            <option value="6">6 personnes</option>
                                            <option value="8+">8+ personnes</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Superficie (m²)</label>
                                        <input type="number" id="surface" name="surface" class="input-field" placeholder="Ex: 65">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2 required">Type de logement</label>
                                        <select id="housing-type" name="housingType" class="input-field" required>
                                            <option value="">Sélectionner</option>
                                            <option value="apartment">Appartement</option>
                                            <option value="house">Maison</option>
                                            <option value="room">Chambre</option>
                                            <option value="shared">Colocation complète</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Équipements -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700 mb-4">⚙️ Équipements essentiels</h3>
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" class="equipment-checkbox" data-name="hasWifi" id="hasWifi" >
                                        <span class="text-sm">📶 Wifi</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" class="equipment-checkbox" data-name="hasWorkspace" id="hasWorkspace" >
                                        <span class="text-sm">💻 Espace de travail</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" class="equipment-checkbox" data-name="hasKitchen" id="hasKitchen" >
                                        <span class="text-sm">🍳 Cuisine équipée</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" class="equipment-checkbox" data-name="hasWashingMachine" id="hasWashingMachine" >
                                        <span class="text-sm">🧺 Machine à laver</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" class="equipment-checkbox" data-name="hasBalcony" id="hasBalcony" >
                                        <span class="text-sm">🌿 Balcon / terrasse</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" class="equipment-checkbox" data-name="hasParking" id="hasParking" >
                                        <span class="text-sm">🚗 Parking</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" class="equipment-checkbox" data-name="petsAccepted" id="petsAccepted" >
                                        <span class="text-sm">🐾 Animaux acceptés</span>
                                    </label>
                                </div>
                                <div class="mt-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Autre équipement</label>
                                    <input type="text" id="other-equipment" name="otherEquipment" class="input-field" placeholder="Ex: piscine, jardin, climatisation...">
                                </div>
                            </div>

                            <!-- Obligations pour le swapper -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700 mb-4">📋 Obligations pour la personne qui vient chez moi (facultatif)</h3>
                                <p class="text-sm text-gray-600 mb-4">💡 Précisez ce que vous attendez de votre swapper pendant son séjour</p>
                                
                                <div class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" class="obligation-checkbox" value="pet-care" name="obligation_pet_care">
                                            <span class="text-sm">🐾 Garder mon animal</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" class="obligation-checkbox" value="plant-care" name="obligation_plant_care">
                                            <span class="text-sm">🌱 Arroser mes plantes</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" class="obligation-checkbox" value="mail-collection" name="obligation_mail_collection">
                                            <span class="text-sm">📬 Relever le courrier</span>
                                        </label>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Autres obligations ou instructions</label>
                                        <textarea id="other-obligations" name="otherObligations" class="textarea-field" placeholder="Ex: nourrir le chat 2x/jour, arroser les orchidées le dimanche, ne pas utiliser la machine à laver la nuit..."></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- Photos -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700 mb-4">📷 Photos de mon logement</h3>
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                    <div class="flex items-center mb-3">
                                        <div class="text-2xl mr-3">📸</div>
                                        <div>
                                            <h4 class="font-semibold text-blue-800">Photos demandées dans un second temps</h4>
                                            <p class="text-sm text-blue-700">Nous vous demanderons d'ajouter vos photos après la création du profil pour optimiser vos chances de match !</p>
                                        </div>
                                    </div>
                                    <p class="text-xs text-blue-600">💡 Conseil : Préparez 5-8 photos de qualité de votre logement (salon, chambre, cuisine, salle de bain, extérieur si applicable)</p>
                                </div>
                            </div>
                            
                            <div class="flex justify-between">
                                <div></div>
                                <button type="button" class="btn-primary" onclick="nextStep()">
                                    Continuer →
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Étape 2: Mon style d'échange et avec qui je veux échanger -->
                <div class="step-card hidden" id="step-2">
                    <div class="step-header">
                        <div class="priority-badge priority-1">ÉTAPE 2</div>
                        <div class="emoji-large">🔄</div>
                        <h2 class="text-2xl font-bold mb-2">Mon style d'échange et avec qui je veux échanger</h2>
                        <p class="text-green-100">Définissez vos préférences d'échange</p>
                    </div>
                    <div class="step-content">
                        <div class="space-y-8">
                            <!-- Style d'échange -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700 mb-4 required">🔁 Mon style d'échange</h3>
                                <div class="space-y-4">
                                    <div class="selection-card" data-group="exchangeStyle" data-value="reciprocal">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-4">🔄</div>
                                            <div>
                                                <h4 class="font-semibold">Échange réciproque</h4>
                                                <p class="text-sm text-gray-600">Chacun séjourne chez l'autre aux mêmes dates</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="selection-card" data-group="exchangeStyle" data-value="delayed">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-4">⏳</div>
                                            <div>
                                                <h4 class="font-semibold">Échange décalé (non simultané)</h4>
                                                <p class="text-sm text-gray-600">Tu accueilles pendant ton absence, et séjournes plus tard chez l'autre</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="selection-card" data-group="exchangeStyle" data-value="both">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-4">⚖️</div>
                                            <div>
                                                <h4 class="font-semibold">Ouvert aux deux</h4>
                                                <p class="text-sm text-gray-600">Flexible selon les opportunités</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Hidden input that Zapier will read -->
                                <input type="hidden" name="exchangeStyle" id="exchangeStyle" value="">

                                <div class="mt-4 hidden" id="delayed-dates">
                                    <h4 class="font-semibold text-gray-700 mb-2">Dates où mon logement sera libre pour accueillir quelqu'un = je ne serais pas chez moi</h4>
                                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                        <p class="text-sm text-blue-700 mb-3">📅 Sélectionnez les périodes où votre logement sera disponible</p>
                                        <div id="delayed-dates-list" class="grid grid-cols-1 md:grid-cols-1 gap-4">
                                            <div class="date-range" data-index="1">
                                                <label class="block text-sm font-medium text-gray-600 mb-2">Du</label>
                                                <input type="date" class="input-field" name="delayedDate1Start">
                                                <label class="block text-sm font-medium text-gray-600 mb-2 mt-2">Au</label>
                                                <input type="date" class="input-field" name="delayedDate1End">
                                            </div>
                                        </div>
                                        <div class="mt-3 flex gap-2">
                                            <button type="button" class="btn-secondary" onclick="addDelayedDateRange()">➕ Ajouter une autre période</button>
                                            <button type="button" class="btn-skip" onclick="removeLastDelayedDateRange()">➖ Supprimer dernière période</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Avec qui je voyage -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700 mb-4 required">👥 Avec qui je voyage</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="selection-card" data-group="travelWith" data-value="alone">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-4">👤</div>
                                            <div>
                                                <h4 class="font-semibold">Seul(e)</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="selection-card" data-group="travelWith" data-value="couple">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-4">💑</div>
                                            <div>
                                                <h4 class="font-semibold">En couple</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="selection-card" data-group="travelWith" data-value="colocation">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-4">🏘️</div>
                                            <div>
                                                <h4 class="font-semibold">En colocation</h4>
                                                <p class="text-sm text-gray-600">Préciser le nombre</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="selection-card" data-group="travelWith" data-value="family">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-4">👪</div>
                                            <div>
                                                <h4 class="font-semibold">En famille</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="selection-card" data-group="travelWith" data-value="other">
                                        <div class="flex items-center">
                                            <div class="text-2xl mr-4">✨</div>
                                            <div>
                                                <h4 class="font-semibold">Autre</h4>
                                                <p class="text-sm text-gray-600">À préciser</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="travelWith" name="travelWith" value="">
                                <div class="mt-4 hidden" id="colocation-details">
                                    <input type="number" name="colocataireCount" class="input-field" placeholder="Nombre de colocataires" min="1" max="10">
                                </div>
                                <div class="mt-4 hidden" id="other-details">
                                    <textarea class="textarea-field" name="otherTravelDetails" placeholder="Précisez avec qui vous voyagez..."></textarea>
                                </div>
                            </div>

                            <!-- Animaux -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700 mb-4 required">🐾 Animaux</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">As-tu un animal ?</label>
                                        <div class="flex gap-4">
                                            <label class="flex items-center cursor-pointer">
                                                <input type="radio" name="hasPet" value="yes" class="mr-2">
                                                <span>Oui</span>
                                            </label>
                                            <label class="flex items-center cursor-pointer">
                                                <input type="radio" name="hasPet" value="no" class="mr-2" checked>
                                                <span>Non</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="hidden" id="pet-details">
                                        <div class="space-y-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Type d'animal</label>
                                                <select class="input-field" name="petType">
                                                    <option value="">Sélectionner</option>
                                                    <option value="dog">Chien</option>
                                                    <option value="cat">Chat</option>
                                                    <option value="other">Autre</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                                <textarea class="textarea-field" name="petDescription" placeholder="Ex: petit chien calme, gros chat indépendant..."></textarea>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Voyages-tu avec ton animal ?</label>
                                                <div class="flex gap-4">
                                                    <label class="flex items-center cursor-pointer">
                                                        <input type="radio" name="travelWithPet" value="yes" class="mr-2">
                                                        <span>Oui</span>
                                                    </label>
                                                    <label class="flex items-center cursor-pointer">
                                                        <input type="radio" name="travelWithPet" value="no" class="mr-2">
                                                        <span>Non</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Profil idéal swapper -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700 mb-4">👤 Profil idéal de mon swapper (facultatif)</h3>
                                <p class="text-sm text-gray-600 mb-4">💡 Précisez le type de personne avec qui vous aimeriez échanger</p>
                                
                                <div class="space-y-4">
                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <label class="block text-sm font-medium text-gray-700">Description libre</label>
                                            <button type="button" class="text-blue-500 hover:text-blue-700 text-sm flex items-center" onclick="showSwapperAssistant()" title="Assistant d'écriture">
                                                ✨ Assistant
                                            </button>
                                        </div>
                                        <textarea id="ideal-swapper-description" name="idealSwapperDescription" class="textarea-field" placeholder="Ex: Personne calme et respectueuse, amateur de culture, jeune professionnel, famille avec enfants..."></textarea>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-3">Tranche d'âge souhaitée</label>
                                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                            <label class="flex items-center space-x-2 cursor-pointer">
                                                <input type="checkbox" name="agePreference18_25" class="age-preference" value="true">
                                                <span class="text-sm">18-25 ans</span>
                                            </label>
                                            <label class="flex items-center space-x-2 cursor-pointer">
                                                <input type="checkbox" name="agePreference26_35" class="age-preference" value="true">
                                                <span class="text-sm">26-35 ans</span>
                                            </label>
                                            <label class="flex items-center space-x-2 cursor-pointer">
                                                <input type="checkbox" name="agePreference36_50" class="age-preference" value="true">
                                                <span class="text-sm">36-50 ans</span>
                                            </label>
                                            <label class="flex items-center space-x-2 cursor-pointer">
                                                <input type="checkbox" name="agePreference50Plus" class="age-preference" value="true">
                                                <span class="text-sm">50+ ans</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-3">Flexibilité recherchée</label>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                            <label class="flex items-center space-x-2 cursor-pointer">
                                                <input type="checkbox" name="flexibilityDates" class="flexibility-preference" value="true">
                                                <span class="text-sm">🗓️ Flexible sur les dates</span>
                                            </label>
                                            <label class="flex items-center space-x-2 cursor-pointer">
                                                <input type="checkbox" name="flexibilityDuration" class="flexibility-preference" value="true">
                                                <span class="text-sm">⏰ Flexible sur la durée</span>
                                            </label>
                                            <label class="flex items-center space-x-2 cursor-pointer">
                                                <input type="checkbox" name="flexibilityDestination" class="flexibility-preference" value="true">
                                                <span class="text-sm">📍 Flexible sur la destination</span>
                                            </label>
                                            <label class="flex items-center space-x-2 cursor-pointer">
                                                <input type="checkbox" name="flexibilityExchangeType" class="flexibility-preference" value="true">
                                                <span class="text-sm">🔄 Flexible sur le type d'échange</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="flex justify-between">
                                <button type="button" class="btn-secondary" onclick="prevStep()">
                                    ← Retour
                                </button>
                                <button type="button" class="btn-primary" onclick="nextStep()">
                                    Continuer →
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Étape 3: Création de mon expérience -->
                <div class="step-card hidden" id="step-3">
                    <div class="step-header">
                        <div class="priority-badge priority-1">ÉTAPE 3</div>
                        <div class="emoji-large">✨</div>
                        <h2 class="text-2xl font-bold mb-2">Création de mon expérience</h2>
                        <p class="text-green-100">Créons votre annonce d'échange attractive</p>
                    </div>
                    <div class="step-content">
                        <div class="space-y-6">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                                <div class="flex items-center mb-2">
                                    <div class="text-2xl mr-3">💡</div>
                                    <h4 class="font-semibold text-blue-800">Qu'est-ce qu'une expérience &SWAPP ?</h4>
                                </div>
                                <p class="text-sm text-blue-700">
                                    Une expérience, c'est votre annonce d'échange ! Elle contient votre destination souhaitée, vos dates, 
                                    un titre accrocheur et une description qui donne envie. Plus elle est détaillée et inspirante, 
                                    plus vous aurez de chances de trouver le swapper parfait ! 🚀
                                </p>
                            </div>

                            <!-- Destination -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700 mb-4 required">🌍 Où je veux partir</h3>
                                <div>
                                    <label for="main-destination" class="block text-sm font-medium text-gray-700 mb-2 required">Ville principale souhaitée</label>
                                    <div class="relative">
                                        <input type="text" id="main-destination" name="mainDestination" class="input-field pr-20" placeholder="Ex: Lisbonne, Tokyo, New York..." required>
                                        <button type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-2xl hover:scale-110 transition-transform" onclick="surpriseMe()" title="Surprenez-moi">
                                            🎲
                                        </button>
                                    </div>
                                    <div class="mt-2 flex flex-wrap gap-2">
                                        <button type="button" class="btn-skip text-xs" onclick="showAvailableCities()">
                                            📍 Voir les villes disponibles
                                        </button>
                                        <button type="button" class="btn-skip text-xs" onclick="showExperienceExamples()">
                                            ✨ Voir des exemples d'expériences
                                        </button>
                                    </div>
                                </div>

                                <div class="mt-6">
                                    <h4 class="text-md font-semibold text-gray-700 mb-3">Options flexibles (facultatif - sélection multiple possible)</h4>
                                    <p class="text-sm text-gray-600 mb-4">💡 Ajouter des options flexibles augmente vos chances de match !</p>
                                    
                                    <!-- Option région -->
                                    <div class="flexible-option mb-3" data-flexible-type="region">
                                        <label class="flex items-center cursor-pointer">
                                            <input type="checkbox" class="flexible-checkbox mr-3" id="flexibleRegionToggle" value="true">
                                            <div>
                                                <h5 class="font-semibold">🌍 Région / zone géographique</h5>
                                                <p class="text-sm text-gray-600">Ex: Sud de la France, Ouest canadien, à moins de 3h de vol de Washington</p>
                                            </div>
                                        </label>
                                        <div class="mt-3 hidden" id="region-input">
                                            <input type="text" id="flexibleRegionInput" class="input-field" placeholder="Décrivez la région souhaitée...">
                                        </div>
                                        <!-- Zapier field -->
                                        <input type="hidden" name="flexibleRegion" id="flexibleRegion">
                                    </div>

                                    <!-- Option villes multiples -->
                                    <div class="flexible-option mb-3" data-flexible-type="cities">
                                        <label class="flex items-center cursor-pointer">
                                            <input type="checkbox" class="flexible-checkbox mr-3" id="flexibleCitiesToggle" value="true">
                                            <div>
                                                <h5 class="font-semibold">📍 Liste de 3 à 5 autres villes</h5>
                                                <p class="text-sm text-gray-600">Ex: Barcelone, Rome, Porto, Séville, Madrid</p>
                                            </div>
                                        </label>
                                        <div class="mt-3 hidden" id="cities-input">
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                                <input type="text" class="input-field" id="flexibleCity1" name="flexibleCity1" placeholder="Ville 1">
                                                <input type="text" class="input-field" id="flexibleCity2" name="flexibleCity2" placeholder="Ville 2">
                                                <input type="text" class="input-field" id="flexibleCity3" name="flexibleCity3" placeholder="Ville 3">
                                                <input type="text" class="input-field" id="flexibleCity4" name="flexibleCity4" placeholder="Ville 4 (optionnel)">
                                                <input type="text" class="input-field" id="flexibleCity5" name="flexibleCity5" placeholder="Ville 5 (optionnel)">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Option type de destination -->
                                    <div class="flexible-option" data-flexible-type="destination-type">
                                        <label class="flex items-center cursor-pointer">
                                            <input type="checkbox" class="flexible-checkbox mr-3" id="flexibleDestinationTypeToggle" value="true">
                                            <div>
                                                <h5 class="font-semibold">☀️ Type de destination</h5>
                                                <p class="text-sm text-gray-600">Ex: au soleil, en montagne, dans une capitale, ville culturelle</p>
                                            </div>
                                        </label>
                                        <div class="mt-3 hidden" id="destination-type-input">
                                            <input type="text" class="input-field" id="flexibleDestinationType" name="flexibleDestinationType" placeholder="Ex: soleil, montagne, capitale...">
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="flex justify-between">
                                <button type="button" class="btn-secondary" onclick="prevStep()">
                                    ← Retour
                                </button>
                                <button type="button" class="btn-primary" onclick="nextStep()">
                                    Continuer →
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hidden helper fields Zapier expects or helpful for mapping -->
                <input type="hidden" name="locationFull" id="locationFull" value="">
                <input type="hidden" name="equipmentCount" id="equipmentCount" value="0">
                <input type="hidden" name="dateRangeCount" id="dateRangeCount" value="0">
                <input type="hidden" name="createdAt" id="createdAt" value="">
                <input type="hidden" name="fullName" id="fullName" value="">
                <input type="hidden" name="profileComplete" id="profileComplete" value="false">
                <!-- Add more hidden fields as required by your Zapier -> Notion mapping -->

            </form>
        </div>
    </div>

    <script>
        // ---- Utility & synchronization for Zapier field names ----

        // Keep track of delayed date ranges (max 3 per your Notion mapping)
        let delayedRangeCount = 1; // we start with 1 pre-rendered
        const maxDelayedRanges = 3;

        function addDelayedDateRange() {
            if (delayedRangeCount >= maxDelayedRanges) return;
            delayedRangeCount++;
            const list = document.getElementById('delayed-dates-list');
            const idx = delayedRangeCount;
            const wrapper = document.createElement('div');
            wrapper.className = 'date-range';
            wrapper.setAttribute('data-index', idx);
            wrapper.innerHTML = `
                <label class="block text-sm font-medium text-gray-600 mb-2">Du</label>
                <input type="date" class="input-field" name="delayedDate${idx}Start">
                <label class="block text-sm font-medium text-gray-600 mb-2 mt-2">Au</label>
                <input type="date" class="input-field" name="delayedDate${idx}End">
            `;
            list.appendChild(wrapper);
            document.getElementById('dateRangeCount').value = delayedRangeCount;
        }

        function removeLastDelayedDateRange() {
            if (delayedRangeCount <= 1) return;
            const list = document.getElementById('delayed-dates-list');
            const last = list.querySelector('.date-range[data-index="' + delayedRangeCount + '"]');
            if (last) list.removeChild(last);
            delayedRangeCount--;
            document.getElementById('dateRangeCount').value = delayedRangeCount;
        }

        // selection-card groups (exchangeStyle, travelWith, etc.)
        document.querySelectorAll('.selection-card[data-group]').forEach(card => {
            card.addEventListener('click', () => {
                const group = card.getAttribute('data-group');
                const val = card.getAttribute('data-value');

                // unselect siblings
                document.querySelectorAll('.selection-card[data-group="'+group+'"]').forEach(sib => sib.classList.remove('selected'));
                card.classList.add('selected');

                // set the hidden input (one per group)
                const hidden = document.getElementById(group);
                if (hidden) hidden.value = val;

                // special UI toggles
                if (group === 'exchangeStyle') {
                    const delayedDates = document.getElementById('delayed-dates');
                    if (val === 'delayed') delayedDates.classList.remove('hidden'); else delayedDates.classList.add('hidden');
                }
                if (group === 'travelWith') {
                    document.getElementById('colocation-details').classList.add('hidden');
                    document.getElementById('other-details').classList.add('hidden');
                    if (val === 'colocation') document.getElementById('colocation-details').classList.remove('hidden');
                    if (val === 'other') document.getElementById('other-details').classList.remove('hidden');
                }
            });
        });

        // equipment checkboxes -> set hidden boolean fields and compute equipmentCount
        const equipmentCheckboxes = document.querySelectorAll('.equipment-checkbox');
        function computeEquipmentCount() {
            let count = 0;
            equipmentCheckboxes.forEach(cb => {
                if (cb.checked) count++;
            });
            document.getElementById('equipmentCount').value = count;
        }
        equipmentCheckboxes.forEach(cb => {
            const name = cb.dataset.name;
            // create corresponding hidden input default=false if not present
            if (name) {
                let hidden = document.querySelector('input[type="hidden"][name="'+name+'"]');
                if (!hidden) {
                    hidden = document.createElement('input');
                    hidden.type = 'hidden';
                    hidden.name = name;
                    hidden.id = name;
                    hidden.value = 'false';
                    document.getElementById('profile-form').appendChild(hidden);
                }
                cb.addEventListener('change', () => {
                    hidden.value = cb.checked ? 'true' : 'false';
                    computeEquipmentCount();
                });
            }
        });
        // initialize equipment count
        computeEquipmentCount();

        // pet radio toggles
        const petRadios = document.querySelectorAll('input[name="hasPet"]');
        petRadios.forEach(r => {
            r.addEventListener('change', () => {
                const details = document.getElementById('pet-details');
                if (r.value === 'yes' && r.checked) details.classList.remove('hidden');
                if (r.value === 'no' && r.checked) details.classList.add('hidden');
            });
        });

        // show/hide region flexible input
        const flexibleRegionToggle = document.getElementById('flexibleRegionToggle');
        if (flexibleRegionToggle) {
            flexibleRegionToggle.addEventListener('change', () => {
                document.getElementById('region-input').classList.toggle('hidden', !flexibleRegionToggle.checked);
                const hidden = document.getElementById('flexibleRegion');
                if (!flexibleRegionToggle.checked) hidden.value = '';
                else hidden.value = document.getElementById('flexibleRegionInput').value || '';
            });
            // sync typed value to hidden field
            const rinput = document.getElementById('flexibleRegionInput');
            if (rinput) {
                rinput.addEventListener('input', () => {
                    document.getElementById('flexibleRegion').value = rinput.value;
                });
            }
        }

        // flexible destination type toggle
        const flexibleDestinationTypeToggle = document.getElementById('flexibleDestinationTypeToggle');
        if (flexibleDestinationTypeToggle) {
            flexibleDestinationTypeToggle.addEventListener('change', () => {
                document.getElementById('destination-type-input').classList.toggle('hidden', !flexibleDestinationTypeToggle.checked);
                if (!flexibleDestinationTypeToggle.checked) {
                    const t = document.getElementById('flexibleDestinationType');
                    if (t) t.value = '';
                }
            });
        }

        // Step navigation simple logic
        let currentStep = 1;
        function updateStepUI() {
            document.getElementById('current-step').textContent = currentStep;
            document.querySelectorAll('.step-card').forEach((el, idx) => {
                const stepIndex = idx + 1;
                if (stepIndex === currentStep) el.classList.remove('hidden'); else el.classList.add('hidden');
            });
            // update progress
            const pct = (currentStep / 4) * 100;
            document.getElementById('progress-fill').style.width = pct + '%';
            // dots
            document.querySelectorAll('.step-dot').forEach(dot => {
                const step = parseInt(dot.getAttribute('data-step'), 10);
                dot.classList.toggle('active', step === currentStep);
                dot.classList.toggle('completed', step < currentStep);
            });
        }
        function nextStep() { if (currentStep < 4) { currentStep++; updateStepUI(); } else { finalizeAndSubmit(); } }
        function prevStep() { if (currentStep > 1) { currentStep--; updateStepUI(); } }
        updateStepUI();

        // City suggestions placeholder (keeps original behaviour)
        const cityInput = document.getElementById('city');
        if (cityInput) {
            cityInput.addEventListener('input', () => {
                // Placeholder: your autocomplete logic goes here
                // For now hide suggestions
                const s = document.getElementById('city-suggestions');
                if (s) s.classList.add('hidden');
            });
        }

        // Surprise me button placeholder
        function surpriseMe() {
            const examples = ['Lisbonne', 'Tokyo', 'New York', 'Barcelone', 'Rome'];
            const pick = examples[Math.floor(Math.random()*examples.length)];
            const md = document.getElementById('main-destination');
            if (md) md.value = pick;
        }

        // On final submit: compute derived fields and optionally submit the form to Zapier
        function finalizeAndSubmit() {
            // Compose locationFull
            const city = (document.getElementById('city') || {}).value || '';
            const postal = (document.getElementById('postal-code') || {}).value || '';
            const region = (document.getElementById('region') || {}).value || '';
            const country = (document.getElementById('country') || {}).value || '';
            const locationFull = [city, postal, region, country].filter(Boolean).join(', ');
            document.getElementById('locationFull').value = locationFull;

            // createdAt
            document.getElementById('createdAt').value = new Date().toISOString();

            // fullName if firstName/lastName exist (these fields might be lower in the real form)
            const firstName = (document.querySelector('input[name="firstName"]') || {}).value || '';
            const lastName = (document.querySelector('input[name="lastName"]') || {}).value || '';
            if (firstName || lastName) document.getElementById('fullName').value = (firstName + ' ' + lastName).trim();

            // dateRangeCount (count delayed ranges present)
            document.getElementById('dateRangeCount').value = delayedRangeCount;

            // equipmentCount already computed, but ensure value set
            computeEquipmentCount();

            // profileComplete: very simple heuristic (you can customize)
            const requiredFilled = city && postal && country && (document.getElementById('bedrooms') || {}).value && (document.getElementById('sleeping-spots') || {}).value;
            document.getElementById('profileComplete').value = requiredFilled ? 'true' : 'false';

            // If the form action is set (Zapier webhook), submit. Otherwise just alert user
            const form = document.getElementById('profile-form');
            if (form.getAttribute('action')) {
                form.submit();
            } else {
                // For testing without Zapier: log values to console (and inform the user)
                console.log('Form prepared for Zapier. Set form.action to your Zapier webhook URL to submit automatically.');
                // Optionally show a modal or message here
                alert('Form is ready. Set the form action to your Zapier webhook URL to submit. Open console to see prepared data.');
            }
        }

        // Example helper functions referenced from UI
        function showAvailableCities() { alert('Ouvrir la liste des villes disponibles (à implémenter)'); }
        function showExperienceExamples() { alert('Montrer des exemples d\'expériences (à implémenter)'); }
        function showSwapperAssistant() { alert('Assistant d\'écriture : à implémenter.'); }

        // Ensure flexibleCities input visibility toggles
        const flexibleCitiesToggle = document.getElementById('flexibleCitiesToggle');
        if (flexibleCitiesToggle) {
            flexibleCitiesToggle.addEventListener('change', () => {
                document.getElementById('cities-input').classList.toggle('hidden', !flexibleCitiesToggle.checked);
            });
        }

        // When user types in flexibleCity inputs nothing else needed - they have proper name attributes

        // If you want to auto-send boolean "false" for unchecked checkboxes (so Notion doesn't receive empty),
        // you can add hidden inputs for them the same way we did for equipment items.
        // Example for age preferences (add hidden fallback booleans)
        ['agePreference18_25','agePreference26_35','agePreference36_50','agePreference50Plus',
         'flexibilityDates','flexibilityDuration','flexibilityDestination','flexibilityExchangeType'].forEach(name => {
            const el = document.querySelector('[name="'+name+'"]');
            if (el) {
                // create fallback hidden input (will be overridden by checkbox if checked)
                let hidden = document.querySelector('input[type="hidden"][name="'+name+'-boolean"]');
                if (!hidden) {
                    hidden = document.createElement('input');
                    hidden.type = 'hidden';
                    hidden.name = name; // make it the same name — unchecked checkboxes will not submit, but we keep this for potential toggles
                    hidden.value = el.checked ? 'true' : '';
                    document.getElementById('profile-form').appendChild(hidden);
                }
                el.addEventListener('change', () => {
                    hidden.value = el.checked ? 'true' : '';
                });
            }
        });
    </script>
</body>
</html>
